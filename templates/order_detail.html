<!-- templates/order_detail.html -->
{% extends 'bases/base-nav.html' %}
{% load qr_code %}

{% block nav %}
  <div class="container-fluid">
    <div class="navbar-brand fw-medium">Orden #{{ order.id }} </div>
    <a class="btn" href="{{ request.META.HTTP_REFERER }}"><i class="bi bi-x-lg"></i></a>
  </div>
{% endblock %}

{% block content %}
  <div class="container mt-3" style="margin-bottom: 6em;">
    {% for message in messages %}
      <div class="alert alert-primary d-flex align-items-center">
        <i class="bi bi-check-circle-fill"></i><span class="ps-1">{{ message }}</span>
      </div>
    {% endfor %}

    {# Detalles de reporte #}
    {% include 'components/order_details_card.html' with order=order qr_visible=True list=True %}

    {% if order.get_report %}
      <div class="card mt-3">
        <div class="card-header text-secondary small">Reporte</div>
        <p class="card-body pb-0">{{ order.get_report.details }}</p>
      </div>
    {% endif %}

    <div class="card mt-3">
      <div class="card-header text-muted small">Artículos</div>

      <ul class="list-group list-group-flush">
        {% for unit in order.units.all %}
          <li class="list-group-item">
            <div class="fw-medium">{{ unit.item.name }}</div>
            <span class="text-secondary small">{{ unit.serial_number }}</span>
          </li>
        {% endfor %}
      </ul>
    </div>
  </div>

  {# Botón de Cancelar para ordenes pendientes #}
  {% if order.status in 'pending, approved' %}
    <div class="fixed-bottom container bg-body">
      <div class="d-grid my-2 ">
        <a href="{% url 'order_cancel' order.pk %}" class="btn btn-primary btn-lg" type="button">Cancelar Orden</a>
      </div>
    </div>
  {% endif %}
{% endblock %}
