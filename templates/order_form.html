<!-- templates/order_form.html -->
{% extends "bases/base-nav.html" %}


{% block script %}
    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('app', () => ({
                items: [],
                a: "b",

                getItemsLength() {  // Cambié "getItemsLenght" a "getItemsLength"
                    return this.items.length;  // Cambié "lenght" a "length"
                },

                addItem(id, name) {
                    // No agregar elementos duplicados
                    if (this.items.find(item => item.id === id)) return;

                    const totalForms = document.getElementById('id_form-TOTAL_FORMS');
                    totalForms.value = this.items.length + 1;

                    // Agregar elemento al array items
                    this.items.push({id: id, name: name, quantity: 1});
                    console.log(this.items);
                },

                removeItem(index) {
                    // Eliminar el elemento del array en el índice especificado
                    this.items.splice(index, 1);

                    // Actualizar el total de formularios
                    const totalForms = document.getElementById('id_form-TOTAL_FORMS');
                    totalForms.value = this.items.length;

                    console.log(this.items);
                }
            }));
        });
    </script>
{% endblock %}

{% block nav %}
<div class="container-fluid">
    <div class="navbar-brand fw-medium">Artículos</div>
    <a class="btn" href="{{ request.META.HTTP_REFERER }}"><i class="bi bi-x-lg"></i></a>
  </div>
{% endblock %}



{% block content %}

<div class="fixed-bottom container bg-body">
    <div class="d-grid my-2 ">
      <button class="btn btn-primary btn-lg" type="button">Ver Carrito (2)</button>
    </div>
  </div>



    <div class="container">


        <div class="conainer mt-2 mb-3">
            <div class="input-group input-group-lg">
                <input type="search" class="form-control" placeholder="Buscar artículo...">
            </div>
        </div>



        {% for item in items %}
            <div class="row mb-3 mx-1">

                <div class="col-3 my-auto ps-0">
                    <img src="https://picsum.photos/200/200" class="img-fluid h-100 rounded-1" alt="Laptop"/>
                </div>

                <a class="col-6 ps-0 text-body link-underline link-underline-opacity-0" href="#">
                    <p class="mb-0 fw-medium text-truncate">{{ item.name }}</p>
                    <p class="text-muted small text-truncate m-0">
                        {{ item.description }}
                    </p>
                </a>

                <div class="col-3 m-0">
                    <button class="btn btn-outline-primary btn-sm mt-auto"
                            @click="addItem( {{ item.pk }}, '{{ item.name }}')">
                        Agregar
                    </button>
                </div>

            </div>
        {% endfor %}



        {% comment %}
        {% endcomment %}
    </div>


    <!-- The Modal -->
    <div class="modal" id="modal">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">Crear Orden</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    {% for message in messages %}
                        <ul class="message">
                            <li>{{ message }}</li>
                        </ul>

                    {% endfor %}

                    <form method="post">
                        {% csrf_token %}
                        {{ order_form.as_p }}

                        <h4>Items</h4>
                        {{ item_formset.management_form }}

                        <template x-for="(item, index) in items" :key="item.id">
                            <div class="p-3 mb-2 bg-primary text-white">
                                <label x-text="item.name"></label>
                                <input type="hidden" x-model="item.id" :name="`form-${index}-item`">
                                <input type="number" min="0" x-model="item.quantity" :name="`form-${index}-quantity`">
                                <button type="button" @click="removeItem(index)">x</button>
                            </div>
                        </template>

                        <input type="submit">
                    </form>


                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                </div>

            </div>
        </div>
    </div>

{% endblock %}


