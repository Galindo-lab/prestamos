<!-- templates/order_form.html -->
{% extends "base.html" %}

{% block script %}
    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('dropdown', () => ({
                items: [],

                addItem(id, name) {
                    // No agregar elementos duplicados
                    if (this.items.find(item => item.id === id)) return;

                    const totalForms = document.getElementById('id_form-TOTAL_FORMS');
                    totalForms.value = this.items.length + 1;

                    // Agregar elemento al array items
                    this.items.push({id: id, name: name, quantity: 1});
                    console.log(this.items);
                },

                removeItem(index) {
                    // Eliminar el elemento del array en el Ã­ndice especificado
                    this.items.splice(index, 1);

                    // Actualizar el total de formularios
                    const totalForms = document.getElementById('id_form-TOTAL_FORMS');
                    totalForms.value = this.items.length;

                    console.log(this.items);
                }
            }));
        });
    </script>
{% endblock %}


{% block content %}


    <div class="container" x-data="dropdown">

        <div class="pb-4">
            <h2>Articulos</h2>
            {% for item in items %}
                <button @click="addItem( {{ item.pk }}, '{{ item.name }}' )">
                    {{ item.name }}
                </button>
            {% endfor %}
        </div>

        <h2>Crear Orden</h2>

        {% for message in messages %}
            <ul class="message">
                <li>{{ message }}</li>
            </ul>
        {% endfor %}

        <form method="post">
            {% csrf_token %}
            {{ order_form.as_p }}

            <h4>Items</h4>
            {{ item_formset.management_form }}

            <template x-for="(item, index) in items" :key="item.id">
                <div class="p-3 mb-2 bg-primary text-white">
                    <label x-text="item.name"></label>
                    <input type="hidden" x-model="item.id" :name="`form-${index}-item`">
                    <input type="number" min="0" x-model="item.quantity" :name="`form-${index}-quantity`">

                    <button type="button" @click="removeItem(index)">x</button>
                </div>
            </template>

            <input type="submit">
        </form>
    </div>

{% endblock %}
